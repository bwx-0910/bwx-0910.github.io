name: Auto Build Data.js

# å½“ notes æ–‡ä»¶å¤¹æœ‰å˜åŒ–æ—¶è‡ªåŠ¨è§¦å‘
on:
  push:
    paths:
      - 'notes/**/*.md'
    branches:
      - main

# è®¾ç½®æƒé™
permissions:
  contents: write

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ æ£€å‡ºä»£ç 
      uses: actions/checkout@v3
      with:
        fetch-depth: 0
    
    - name: ğŸ è®¾ç½® Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
    
    - name: ğŸ“¦ å®‰è£…ä¾èµ–
      run: |
        pip install python-dotenv
    
    - name: ğŸ”¨ æ„å»º data.js
      run: |
        cd ${{ github.workspace }}
        python build.py
    
    - name: ğŸ“¤ æäº¤æ›´æ”¹
      run: |
        git config --local user.email "github-actions[bot]@users.noreply.github.com"
        git config --local user.name "github-actions[bot]"
        
        # æ£€æŸ¥æ˜¯å¦æœ‰å˜åŒ–
        if [[ -n $(git status -s) ]]; then
          git add js/data.js
          git commit -m "ğŸ¤– è‡ªåŠ¨æ„å»º: æ›´æ–° data.js [skip ci]"
          git push
          echo "âœ… data.js å·²æ›´æ–°å¹¶æ¨é€"
        else
          echo "â„¹ï¸ æ²¡æœ‰å˜åŒ–éœ€è¦æäº¤"
        fi
    
    - name: ğŸ‰ å®Œæˆ
      run: |
        echo "================================"
        echo "âœ… è‡ªåŠ¨æ„å»ºå®Œæˆï¼"
        echo "================================"
        echo "data.js å·²è‡ªåŠ¨æ›´æ–°"
        echo "åšå®¢å°†åœ¨ 1-2 åˆ†é’Ÿåæ›´æ–°"
        echo "================================"
